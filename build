#!/bin/bash

compiler=dmd
defBuildParams="--compiler=$compiler"
if [ $1 ]; then buildType=$1; else buildType=debug; fi
buildParams=${@:2}
rootDir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

function buildLib {
    dub remove-local $rootDir/$1
    cd $rootDir/$1 &&
    dub build $defBuildParams $buildParams &&
    dub test $defBuildParams $buildParams &&
    cp -fr lib/libflow-$1.so ../run/lib &&
    dub add-local ./
}

function buildBin {
    cd $rootDir/$1 &&
    dub build --build $buildType $defBuildParams $buildParams
}

buildLib base &&

buildLib complex &&

buildBin run
